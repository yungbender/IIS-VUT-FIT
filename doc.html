<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=iso-8859-2"/>
    <title>Projekt IIS</title>
    <style type="text/css">
    	table { border-collapse: collapse; }
    	td, th { border: 1px solid black; padding: 0.3em 0.5em; text-align: left; }
    	dt { font-weight: bold; margin-top: 0.5em; }
    </style>
</head>
<body>

<!-- Zkontrolujte prosím nastavení kódování v hlavièce dokumentu 
     podle pou¾itého editoru -->

<h1>ITS (Issue Tracking System)</h1> <!-- Nahradte názvem svého zadání -->

<dl>
	<dt>Autori</dt>
	<dd>Sasák Tomá¹ <!-- Nahraïte skuteèným jménem a e-mailem autora a popisem èinnosti -->
	    <a href="mailto:xsasak01@stud.fit.vutbr.cz">xsasak01@stud.fit.vutbr.cz</a> -
		Backend, výpomoc s frontendom
	</dd>
	<dd>Krajèi Martin <!-- Nahraïte skuteèným jménem a e-mailem autora a popisem èinnosti -->
	    <a href="mailto:xkrajc21@stud.fit.vutbr.cz">xkrajc21@stud.fit.vutbr.cz</a> - 
        Frontend, výpomoc s backendom
	</dd>
  <dd>Gregorová Jana <!-- Nahraïte skuteèným jménem a e-mailem autora a popisem èinnosti -->
	    <a href="mailto:xgrego20@stud.fit.vutbr.cz">xgrego02@stud.fit.vutbr.cz</a> - 
		Výpomoc s frontendom a backendom
	</dd>
	<dt>URL aplikace</dt>
	<dd><a href="http://104.248.134.232/">104.248.134.232/</a></dd>
</dl>

<h2>U¾ívatelia systému pre testovanie</h2>
<table>
<tr><th>Login</th><th>Heslo</th><th>Role</th></tr>
<tr><td>admin</td><td>adminananas</td><td>Administrátor</td></tr>
<tr><td>owner</td><td>ownerananas</td><td>Vedúci</td></tr>
<tr><td>manager</td><td>managerananas</td><td>Mana¾ér</td></tr>
<tr><td>developer</td><td>developerananas</td><td>Pracovník</td></tr>
<tr><td>user</td><td>userananas</td><td>Zákazník</td></tr>
</table>

<h2>Implementácia</h2>
<h3>Backend</h3>
<p>Ako implementaèná jazyk, sme si vybrali jazyk Python3. Python3 má dostupný framework pre programovanie
	webových slu¾iem menom Flask, ktorý sme pou¾ili. Pre implementáciu pou¾ívame návrhový vzor Mode-View-Controller.
	Pre udr¾ovanie jednotnosti Python3 modulov, pou¾ívame tool Pipenv, pou¾ívané moduly sú v súbore Pipfile.
	<h4>Model</h4>
	Model, databáza a jej tabuµky sú namapované pomocou ORM frameworku Peewee. Tieto modely sú namapované na tabuµky v prieèinku /models.
	Pre èistotu kódu a pou¾iteµnos», sme sa rozhodli implementova» nad vrstvu modelu návrhový vzor repozitár. Tento návrhový vzor obsahuje
	zjednotené dotazy na databázu, aby pri ka¾dom dotaze v inom controlleri nebolo nutné písa» dotazy znova a znova.
	<h5>Repozitár</h5>
	Ako vy¹¹ie spomínané, pou¾íva sa pre jednoduchos» dotazovania a nereprodukovania rovnakého kódu. Ka¾dý model, má nad sebou navrhnutý repozitár
	 v ktorom sú napísané dotazy, ktoré sa týkajú daného modelu. Repozitáre je mo¾né nájs» v prieèinku /repositories, v koreòovom adresári projektu.
	<h4>View</h4>
	Vaè¹í popis o tejto èasti je mo¾né nájs» v následujúcej èasti frontend. Z pohµadu backendu, sú HTML templates ulo¾ené v prieèinku /templates v 
	koreòovom adresári projektu. Templaty, sú napísané pomocu CSS a HTML, majú v sebe ¹peciálne miesta, kde sa generujú prvky a informácie dynamicky.
	Tieto dynamické èasti a prvky, spracováva a prepisuje webový templatovací engine Jinja. Server prepisuje tieto miesta a vkladá do nich prvky.
	<h4>Controller</h4>
	Logika celého projektu, v¹etky controllery sa nachádzajú v koreòovom prieèinku /  , s príponami .py. WSGI poèúva na dotazy od u¾ivateµa a
	na základe zadanej cesty, ktorú u¾ivateµ má zadanú v prehlidaèi, spustí danú funkciu controllera. Ka¾dý controller má na zaèiatku nainicializovaný 
	urèitý nutný repozitár, pre dotaz na databázu a vybratie danej informácie z databáze. Vykoná urèitú logiku, výpoèet, vybere HTML view (template), ktorý sa bude
	renderova» pre odpoveï a odo¹le mu dané modely, z ktorých sa èerpajú informácie pre vygenerovanie viewu. Po vygenerovaní viewu sa dané HTML, CSS a JavaScript sa odo¹le
	u¾ivateµovi ako odpoveï na jeho dotaz.<br><br>
	Potom architektúra aplikácie vyzerá následovne.<br>
	<image src="./documentation/architecture.png"></image>
	<h4>Upload</h4>
	V aplikácií umo¾òujeme u¾ivatelom nahranie profilovej fotky, alebo fotky do ticketu. Nahrávanie spracováva server a ka¾dý jeden nahratý obrázok ukladá do
	prieèinku /templates/static/uploads, kde sa ka¾dá fotka premenuje na èíslo a príponu súboru. Potom toto celé meno je ulo¾ené ako text do databázy. Pri zobrazovaní
	daných obrázkov sa názov obrázku bere z databázy a obsah obrázka sa bere z daného prieèinku.
</p>
<h3>Frontend</h3>
<p>Jednotlivé stránky boli vytvárané u¾ pomocou spomínaných technológií HTML a CSS. Ka¾dá stránka obsahuje urèitý základ, ktorý pochádza zo súboru base.html. Tento súbor
	obsahuje pozadie a hlavnú li¹tu, nachádzajúcu sa na úplnom vrhchu stránok. Hlavný obsah stránok sa nachádza v príslu¹ných súboroch s príponou .html. ©týl týchto
	stránok sa nachádza vo väè¹ine prípadoch v súbore s rovnakým pomenovaním a príponou .css v prieèinku /static. V prieèinku /static sa taktie¾ nachádzajú obrázky pou¾ité
	pri tvorbe stránok a súbory s príponou .js, obsahujúce funkcie z jazyka JavaScript. Tieto funkcie boli vyu¾íté napríklad na schovávanie prvkov na u¾ naèítanej stránke.
</p>
<h3>Databáza</h3>
Pre databázu sme si vybrali SØBD PostgreSQL. Inicializaèný SQL skript databáze sa nachádza v prieèinku /database, súbor create_db.sql. Pre databázu sme vytvorili nasledujúci ER diagaram
<br>
<image src="./documentation/er.png"></image><br><br>
Pre komunikáciu s webovou aplikáciou, je v incializaènom SQL skripte uvedený u¾ivatel iis-webapp, ktorý patrí webovej aplikácií a ma prístup pre zápis a èítanie. Existuje e¹te 
admin úèet, iis_admin, ktorý je pre ¹peciálny prístup (napr. z psql CLI).
U¾ivatelské heslá, sú hashované pomocou hashovacieho algoritmu SHA-512, ku tomu sa e¹te prikladá tajný klúè, ktorý sa skonkatenuje s vybraným heslom pri registrácií, salting.
<h3>Zjednotenie aplikácie</h3>
Preto¾e SØBD a aplikácia sú dve odli¹né èasti, ktoré vzájomne potrebujú komunikova» pre dosiahnutie funkcionality danej aplikácie, rozhodli sme sa
pre skontajnerovanie týchto dvoch èastí. Aplikácia sa teda skladá z dvoch kontajnerov. Prvý kontajner je webová aplikácia a druhý databáza. Kontajnerovací
software sme si vybrali Docker. Webová aplikácia má svoj nadefinovaný kontajner v súbore Dockerifle-webapp. Databáza ma svoj nadefinovaný kontajner v súbore 
Dockerfile-database.<br><br>
Tieto dva kontajnery bolo nutné nastavi» v rámci svojej siete, v ktorej mô¾u komunikova» medzi sebou. Na toto sa pou¾il software docker-compose, ktorý spravuje
kontajnery v rámci skupiny a povoluje rôzne nastavenia medzi nimi. Nastavenie tejto dvojice sa nachádza v súbore docker-compose.yml, v koreòovom adresári.<br>
Potom èasti vyzerajú následovne <br>
<image src="./documentation/containers.png"></image><br>
Je e¹te nutné doda», ¾e kontajner s aplikáciou poèúva dotazy z vonku na globálnej sieti na porte 80.

<br><br>
V prieèinku /enviroment sa nachádzajú premenné pre daný kontajner, ktoré obsahujú prihlasovacie údaje do databázy.

<h2>In¹talácia</h2>
<h3>Prerekvizity</h3>
<ul>
	<li>Pripojenie ku internetu</li>
	<li>Nain¹talovaný Docker</li>
	<li>Nain¹talovaný Docker-compose</li>
	<li>Volný port 80 a 5432</li>
</ul>
<p>Ako je vy¹¹ie spomínané, celá aplikácia je ulo¾ená do dvoch kontajnerov pomocou 
	kontajnerovacieho software Docker. Pre spustenie aplikácie: <br><br>
	<b>docker-compose up --build</b><br><br>
	Docker pos»ahuje obrazy a spojazdní aplikáciu, po inicializácií WSGI gunicorn vypí¹e PID
	¹tyroch procesov, ktoré poèúvajú na HTTP dotazy. To znamená ¾e aplikácia a databáza be¾í.<br>
	Aplikácia existuje a be¾í, databáza tie¾, e¹te je nutné nainicializova» databázovú schému.
	Pre toto existuje script v prieèinku database menom <b>exec_script.sh</b>, skript funguje tak,
	¾e ako prvý parameter bere SQL skript, ktorého obsah vlo¾í do kontajneru s databázou.
	Pre inicliazáciu databáze je nutné spusti».<br><br>
	<b>bash exec_script.sh create_db.sql</b><br><br>
	Databáza je nainicializovaná, aplikácia be¾í. Mô¾me zaèa» aplikáciu pou¾íva».
</p>
<h2>Hosting aplikácie</h2>
Vzhµadom na to, ¾e táto implementácia nemô¾e by» hos»ovaná na ¹kolskom serveri Merlin/Eva, pou¾ívame pre hosting portál Digital Ocean. Na tejto platforme aplikácia 
a databáza be¾ia v sieti kontajnerov a pracujú na uvedenej IP adrese vy¹¹ie, port 80 a 5432. Celá aplikácia, je nastavená ako service pre service manager systemctl.
</body>
</html>
